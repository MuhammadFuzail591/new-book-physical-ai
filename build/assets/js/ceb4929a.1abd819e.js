"use strict";(globalThis.webpackChunkphysical_ai_textbook=globalThis.webpackChunkphysical_ai_textbook||[]).push([[9222],{8453:(e,n,a)=>{a.d(n,{R:()=>o,x:()=>i});var t=a(6540);const s={},r=t.createContext(s);function o(e){const n=t.useContext(r);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),t.createElement(r.Provider,{value:n},e.children)}},9223:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>p,frontMatter:()=>r,metadata:()=>i,toc:()=>c});var t=a(4848),s=a(8453);const r={title:"Chapter 5 - Building ROS 2 Packages, Launch Files & Parameters"},o="Chapter 5: Building ROS 2 Packages, Launch Files & Parameters",i={id:"ros2-packages/index",title:"Chapter 5 - Building ROS 2 Packages, Launch Files & Parameters",description:"Chapter Overview",source:"@site/docs/physical-ai/ros2-packages/index.mdx",sourceDirName:"ros2-packages",slug:"/ros2-packages/",permalink:"/ros2-packages/",draft:!1,unlisted:!1,editUrl:"https://github.com/MuhammadFuzail591/new-book-physical-ai/tree/main/docs/physical-ai/ros2-packages/index.mdx",tags:[],version:"current",frontMatter:{title:"Chapter 5 - Building ROS 2 Packages, Launch Files & Parameters"},sidebar:"tutorialSidebar",previous:{title:"Chapter 3 - ROS 2 Architecture Chapter Summary",permalink:"/ros2-architecture/chapter-summary"},next:{title:"Building ROS 2 Packages",permalink:"/ros2-packages/building-packages"}},l={},c=[{value:"Chapter Overview",id:"chapter-overview",level:2},{value:"Learning Outcomes",id:"learning-outcomes",level:2},{value:"Understanding ROS 2 Package Structure",id:"understanding-ros-2-package-structure",level:2},{value:"Package Anatomy and Organization",id:"package-anatomy-and-organization",level:3},{value:"Creating a Complete Package Example",id:"creating-a-complete-package-example",level:3}];function m(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"chapter-5-building-ros-2-packages-launch-files--parameters",children:"Chapter 5: Building ROS 2 Packages, Launch Files & Parameters"}),"\n",(0,t.jsx)(n.h2,{id:"chapter-overview",children:"Chapter Overview"}),"\n",(0,t.jsx)(n.p,{children:"This chapter delves into the fundamental building blocks of ROS 2 development: packages, launch files, and parameters. We'll explore how to create, structure, and organize ROS 2 packages effectively, implement sophisticated launch systems for managing complex robotic applications, and utilize the powerful parameter system for runtime configuration. These elements form the foundation for developing maintainable, scalable, and configurable robotic systems."}),"\n",(0,t.jsx)(n.h2,{id:"learning-outcomes",children:"Learning Outcomes"}),"\n",(0,t.jsx)(n.p,{children:"By the end of this chapter, you will be able to:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Create and structure ROS 2 packages following best practices"}),"\n",(0,t.jsx)(n.li,{children:"Implement comprehensive launch files for managing complex robot systems"}),"\n",(0,t.jsx)(n.li,{children:"Design and utilize the ROS 2 parameter system for runtime configuration"}),"\n",(0,t.jsx)(n.li,{children:"Create custom message, service, and action definitions"}),"\n",(0,t.jsx)(n.li,{children:"Build and install ROS 2 packages with proper dependencies"}),"\n",(0,t.jsx)(n.li,{children:"Implement parameter validation and dynamic reconfiguration"}),"\n",(0,t.jsx)(n.li,{children:"Design launch file architectures for multi-robot systems"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"understanding-ros-2-package-structure",children:"Understanding ROS 2 Package Structure"}),"\n",(0,t.jsx)(n.h3,{id:"package-anatomy-and-organization",children:"Package Anatomy and Organization"}),"\n",(0,t.jsx)(n.p,{children:"A ROS 2 package is the basic unit of software organization that contains source code, launch files, configuration files, and build configuration. Understanding the proper structure is crucial for maintainable robotic applications:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"my_robot_package/\n\u251c\u2500\u2500 CMakeLists.txt              # Build configuration for C++\n\u251c\u2500\u2500 package.xml                 # Package metadata and dependencies\n\u251c\u2500\u2500 setup.py                    # Python build configuration\n\u251c\u2500\u2500 setup.cfg                   # Installation configuration\n\u251c\u2500\u2500 src/                        # Source code\n\u2502   \u251c\u2500\u2500 cpp/                    # C++ source files\n\u2502   \u2514\u2500\u2500 python/                 # Python source files\n\u251c\u2500\u2500 include/                    # C++ header files\n\u251c\u2500\u2500 launch/                     # Launch files\n\u251c\u2500\u2500 config/                     # Configuration files\n\u251c\u2500\u2500 params/                     # Parameter files\n\u251c\u2500\u2500 test/                       # Test files\n\u251c\u2500\u2500 scripts/                    # Executable scripts\n\u251c\u2500\u2500 msg/                        # Custom message definitions\n\u251c\u2500\u2500 srv/                        # Custom service definitions\n\u251c\u2500\u2500 action/                     # Custom action definitions\n\u2514\u2500\u2500 resource/                   # Package resource files\n"})}),"\n",(0,t.jsx)(n.p,{children:"Let's examine the essential files and their roles:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-xml",children:'\x3c!-- package.xml --\x3e\n<?xml version="1.0"?>\n<?xml-model href="http://download.ros.org/schema/package_format3.xsd" schematypens="http://www.w3.org/2001/XMLSchema"?>\n<package format="3">\n  <name>my_robot_package</name>\n  <version>1.0.0</version>\n  <description>My Robot Package for Physical AI Applications</description>\n  <maintainer email="maintainer@example.com">Maintainer Name</maintainer>\n  <license>Apache License 2.0</license>\n\n  <buildtool_depend>ament_cmake</buildtool_depend>\n  <buildtool_depend>ament_python</buildtool_depend>\n\n  <depend>rclcpp</depend>\n  <depend>rclpy</depend>\n  <depend>std_msgs</depend>\n  <depend>sensor_msgs</depend>\n  <depend>geometry_msgs</depend>\n  <depend>nav_msgs</depend>\n  <depend>tf2</depend>\n  <depend>tf2_ros</depend>\n  <depend>message_runtime</depend>\n\n  <build_depend>rosidl_default_generators</build_depend>\n  <exec_depend>rosidl_default_runtime</exec_depend>\n  <member_of_group>rosidl_interface_packages</member_of_group>\n\n  <test_depend>ament_lint_auto</test_depend>\n  <test_depend>ament_lint_common</test_depend>\n\n  <export>\n    <build_type>ament_cmake</build_type>\n  </export>\n</package>\n'})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-cmake",children:'# CMakeLists.txt for C++ packages\ncmake_minimum_required(VERSION 3.8)\nproject(my_robot_package)\n\nif(CMAKE_COMPILER_IS_GNUCXX OR CMAKE_CXX_COMPILER_ID MATCHES "Clang")\n  add_compile_options(-Wall -Wextra -Wpedantic)\nendif()\n\n# Find dependencies\nfind_package(ament_cmake REQUIRED)\nfind_package(rclcpp REQUIRED)\nfind_package(rclpy REQUIRED)\nfind_package(std_msgs REQUIRED)\nfind_package(sensor_msgs REQUIRED)\nfind_package(geometry_msgs REQUIRED)\nfind_package(nav_msgs REQUIRED)\nfind_package(tf2 REQUIRED)\nfind_package(tf2_ros REQUIRED)\n\n# Custom message generation\nfind_package(rosidl_default_generators REQUIRED)\n\n# Define custom messages\nrosidl_generate_interfaces(${PROJECT_NAME}\n  "msg/RobotState.msg"\n  "msg/SensorData.msg"\n  "srv/RobotControl.srv"\n  "action/Navigation.action"\n  DEPENDENCIES std_msgs sensor_msgs geometry_msgs\n)\n\n# Build C++ nodes\nadd_executable(robot_controller src/cpp/robot_controller.cpp)\nament_target_dependencies(robot_controller\n  rclcpp\n  std_msgs\n  sensor_msgs\n  geometry_msgs\n)\n\n# Install targets\ninstall(TARGETS\n  robot_controller\n  DESTINATION lib/${PROJECT_NAME}\n)\n\ninstall(DIRECTORY\n  launch\n  config\n  params\n  DESTINATION share/${PROJECT_NAME}/\n)\n\nament_package()\n'})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:"# setup.py for Python packages\nfrom setuptools import setup\nfrom glob import glob\nimport os\n\npackage_name = 'my_robot_package'\n\nsetup(\n    name=package_name,\n    version='1.0.0',\n    packages=[package_name],\n    data_files=[\n        ('share/ament_index/resource_index/packages',\n            ['resource/' + package_name]),\n        ('share/' + package_name, ['package.xml']),\n        (os.path.join('share', package_name, 'launch'), glob('launch/*.py')),\n        (os.path.join('share', package_name, 'config'), glob('config/*.yaml')),\n        (os.path.join('share', package_name, 'params'), glob('params/*.yaml')),\n    ],\n    install_requires=['setuptools'],\n    zip_safe=True,\n    maintainer='Maintainer Name',\n    maintainer_email='maintainer@example.com',\n    description='My Robot Package for Physical AI Applications',\n    license='Apache License 2.0',\n    tests_require=['pytest'],\n    entry_points={\n        'console_scripts': [\n            'robot_controller = my_robot_package.robot_controller:main',\n            'sensor_processor = my_robot_package.sensor_processor:main',\n            'navigation_node = my_robot_package.navigation_node:main',\n        ],\n    },\n)\n"})}),"\n",(0,t.jsx)(n.h3,{id:"creating-a-complete-package-example",children:"Creating a Complete Package Example"}),"\n",(0,t.jsx)(n.p,{children:"Let's create a comprehensive example package that demonstrates proper structure:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:"# my_robot_package/my_robot_package/robot_controller.py\nimport rclpy\nfrom rclpy.node import Node\nfrom rclpy.qos import QoSProfile, qos_profile_sensor_data\nfrom std_msgs.msg import String, Float64\nfrom geometry_msgs.msg import Twist\nfrom sensor_msgs.msg import LaserScan, Imu\nfrom my_robot_package.msg import RobotState, SensorData\nfrom my_robot_package.srv import RobotControl\nfrom my_robot_package.action import Navigation\nfrom rclpy.action import ActionServer, ActionClient\nfrom rclpy.parameter import Parameter\nfrom collections import deque\nimport math\nimport time\n\nclass RobotControllerNode(Node):\n    def __init__(self):\n        super().__init__('robot_controller')\n\n        # Declare parameters with default values and descriptions\n        self.declare_parameter('robot_name', 'default_robot',\n                              ParameterDescriptor(description='Name of the robot'))\n        self.declare_parameter('max_linear_velocity', 1.0,\n                              ParameterDescriptor(description='Maximum linear velocity (m/s)'))\n        self.declare_parameter('max_angular_velocity', 1.0,\n                              ParameterDescriptor(description='Maximum angular velocity (rad/s)'))\n        self.declare_parameter('safety_distance', 0.5,\n                              ParameterDescriptor(description='Minimum safety distance (m)'))\n        self.declare_parameter('control_frequency', 50.0,\n                              ParameterDescriptor(description='Control loop frequency (Hz)'))\n\n        # Get parameter values\n        self.robot_name = self.get_parameter('robot_name').value\n        self.max_linear_vel = self.get_parameter('max_linear_velocity').value\n        self.max_angular_vel = self.get_parameter('max_angular_velocity').value\n        self.safety_distance = self.get_parameter('safety_distance').value\n        self.control_frequency = self.get_parameter('control_frequency').value\n\n        # Publishers\n        self.cmd_vel_pub = self.create_publisher(Twist, 'cmd_vel', 10)\n        self.status_pub = self.create_publisher(String, 'robot_status', 10)\n        self.state_pub = self.create_publisher(RobotState, 'robot_state', 10)\n\n        # Subscribers\n        self.laser_sub = self.create_subscription(\n            LaserScan, 'laser_scan', self.laser_callback,\n            qos_profile=qos_profile_sensor_data\n        )\n        self.imu_sub = self.create_subscription(\n            Imu, 'imu/data', self.imu_callback,\n            qos_profile=qos_profile_sensor_data\n        )\n\n        # Service server\n        self.control_srv = self.create_service(\n            RobotControl, 'robot_control', self.control_service_callback\n        )\n\n        # Action server\n        self.navigation_action_server = ActionServer(\n            self, Navigation, 'navigate_to_waypoint',\n            self.navigation_execute_callback\n        )\n\n        # Robot state tracking\n        self.robot_state = {\n            'position': {'x': 0.0, 'y': 0.0, 'theta': 0.0},\n            'velocity': {'linear': 0.0, 'angular': 0.0},\n            'safety_status': 'normal',\n            'battery_level': 100.0\n        }\n\n        # Sensor data storage\n        self.sensor_data = {\n            'laser_ranges': [],\n            'imu_orientation': None,\n            'imu_angular_velocity': None\n        }\n\n        # Control loop timer\n        self.control_timer = self.create_timer(\n            1.0 / self.control_frequency, self.control_loop\n        )\n\n        # Statistics\n        self.stats = {\n            'messages_received': 0,\n            'commands_sent': 0,\n            'safety_interventions': 0\n        }\n\n        self.get_logger().info(f'Robot Controller initialized for {self.robot_name}')\n\n    def laser_callback(self, msg):\n        \"\"\"Handle laser scan data.\"\"\"\n        self.stats['messages_received'] += 1\n        self.sensor_data['laser_ranges'] = msg.ranges\n\n        # Check for obstacles\n        if msg.ranges:\n            min_range = min([r for r in msg.ranges if not math.isnan(r)], default=float('inf'))\n            if min_range < self.safety_distance:\n                self.robot_state['safety_status'] = 'obstacle_detected'\n                self.get_logger().warn(f'Obstacle detected at {min_range:.2f}m')\n            else:\n                self.robot_state['safety_status'] = 'normal'\n\n    def imu_callback(self, msg):\n        \"\"\"Handle IMU data.\"\"\"\n        self.stats['messages_received'] += 1\n        self.sensor_data['imu_orientation'] = msg.orientation\n        self.sensor_data['imu_angular_velocity'] = msg.angular_velocity\n\n    def control_service_callback(self, request, response):\n        \"\"\"Handle robot control service requests.\"\"\"\n        command = request.command.lower()\n\n        if command == 'emergency_stop':\n            self.emergency_stop()\n            response.success = True\n            response.message = 'Emergency stop activated'\n        elif command == 'reset':\n            self.reset_robot()\n            response.success = True\n            response.message = 'Robot reset'\n        elif command == 'get_status':\n            response.success = True\n            response.message = f'Robot status: {self.robot_state[\"safety_status\"]}'\n        else:\n            response.success = False\n            response.message = f'Unknown command: {command}'\n\n        return response\n\n    def navigation_execute_callback(self, goal_handle):\n        \"\"\"Execute navigation goal.\"\"\"\n        self.get_logger().info('Executing navigation goal...')\n\n        target_x = goal_handle.request.target_pose.position.x\n        target_y = goal_handle.request.target_pose.position.y\n\n        # Navigation execution logic\n        current_x = self.robot_state['position']['x']\n        current_y = self.robot_state['position']['y']\n\n        distance = math.sqrt((target_x - current_x)**2 + (target_y - current_y)**2)\n\n        if distance < 0.1:  # Already at goal\n            goal_handle.succeed()\n            result = Navigation.Result()\n            result.success = True\n            result.message = 'Already at target position'\n            goal_handle.publish_result(result)\n            return\n\n        # Move towards target (simplified)\n        cmd_msg = Twist()\n        cmd_msg.linear.x = min(0.5, distance)  # Move at 0.5 m/s or distance if closer\n        cmd_msg.angular.z = 0.0  # Simplified navigation\n\n        self.cmd_vel_pub.publish(cmd_msg)\n\n        # Wait for navigation to complete (simplified)\n        time.sleep(min(10.0, distance / 0.5))  # Wait based on distance\n\n        # Check if goal was achieved\n        new_distance = math.sqrt(\n            (target_x - self.robot_state['position']['x'])**2 +\n            (target_y - self.robot_state['position']['y'])**2\n        )\n\n        if new_distance < 0.2:  # Within tolerance\n            goal_handle.succeed()\n            result = Navigation.Result()\n            result.success = True\n            result.message = f'Navigated to ({target_x:.2f}, {target_y:.2f})'\n        else:\n            goal_handle.abort()\n            result = Navigation.Result()\n            result.success = False\n            result.message = f'Failed to reach target, {new_distance:.2f}m away'\n\n        goal_handle.publish_result(result)\n\n    def control_loop(self):\n        \"\"\"Main control loop.\"\"\"\n        # Publish robot status\n        status_msg = String()\n        status_msg.data = f'Robot: {self.robot_name}, Status: {self.robot_state[\"safety_status\"]}'\n        self.status_pub.publish(status_msg)\n\n        # Publish robot state\n        state_msg = RobotState()\n        state_msg.header.stamp = self.get_clock().now().to_msg()\n        state_msg.header.frame_id = 'base_link'\n        state_msg.position.x = self.robot_state['position']['x']\n        state_msg.position.y = self.robot_state['position']['y']\n        state_msg.position.z = 0.0\n        state_msg.velocity.linear = self.robot_state['velocity']['linear']\n        state_msg.velocity.angular = self.robot_state['velocity']['angular']\n        state_msg.safety_status = self.robot_state['safety_status']\n        state_msg.battery_level = self.robot_state['battery_level']\n        self.state_pub.publish(state_msg)\n\n    def emergency_stop(self):\n        \"\"\"Emergency stop the robot.\"\"\"\n        cmd_msg = Twist()\n        cmd_msg.linear.x = 0.0\n        cmd_msg.angular.z = 0.0\n        self.cmd_vel_pub.publish(cmd_msg)\n        self.robot_state['safety_status'] = 'emergency_stop'\n        self.get_logger().error('EMERGENCY STOP ACTIVATED')\n\n    def reset_robot(self):\n        \"\"\"Reset robot state.\"\"\"\n        self.robot_state['position'] = {'x': 0.0, 'y': 0.0, 'theta': 0.0}\n        self.robot_state['velocity'] = {'linear': 0.0, 'angular': 0.0}\n        self.robot_state['safety_status'] = 'normal'\n        self.get_logger().info('Robot reset to initial state')\n\ndef main(args=None):\n    rclpy.init(args=args)\n    node = RobotControllerNode()\n    try:\n        rclpy.spin(node)\n    except KeyboardInterrupt:\n        node.get_logger().info('Shutting down robot controller...')\n    finally:\n        node.destroy_node()\n        rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})})]})}function p(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(m,{...e})}):m(e)}}}]);