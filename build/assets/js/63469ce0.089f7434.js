"use strict";(globalThis.webpackChunkphysical_ai_textbook=globalThis.webpackChunkphysical_ai_textbook||[]).push([[9991],{8374:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>t,metadata:()=>o,toc:()=>c});var s=i(4848),r=i(8453);const t={title:"Chapter 3 - Understanding the Robotic Nervous System: ROS 2 Architecture"},l="Chapter 3: Understanding the Robotic Nervous System: ROS 2 Architecture",o={id:"ros2-architecture/index",title:"Chapter 3 - Understanding the Robotic Nervous System: ROS 2 Architecture",description:"Chapter Overview",source:"@site/docs/physical-ai/ros2-architecture/index.mdx",sourceDirName:"ros2-architecture",slug:"/ros2-architecture/",permalink:"/ros2-architecture/",draft:!1,unlisted:!1,editUrl:"https://github.com/fuzailpalook/new-book/tree/main/docs/physical-ai/ros2-architecture/index.mdx",tags:[],version:"current",frontMatter:{title:"Chapter 3 - Understanding the Robotic Nervous System: ROS 2 Architecture"},sidebar:"tutorialSidebar",previous:{title:"Chapter 2 - Humanoid Robotics Chapter Summary",permalink:"/humanoid-robotics/chapter-summary"},next:{title:"Nodes and Topics in ROS 2",permalink:"/ros2-architecture/nodes-topics"}},a={},c=[{value:"Chapter Overview",id:"chapter-overview",level:2},{value:"Learning Outcomes",id:"learning-outcomes",level:2},{value:"Introduction to ROS 2",id:"introduction-to-ros-2",level:2},{value:"What is ROS 2?",id:"what-is-ros-2",level:3},{value:"Historical Context: From ROS 1 to ROS 2",id:"historical-context-from-ros-1-to-ros-2",level:3},{value:"ROS 1 Limitations",id:"ros-1-limitations",level:4},{value:"ROS 2 Solutions",id:"ros-2-solutions",level:4},{value:"Key Concepts in ROS 2 Architecture",id:"key-concepts-in-ros-2-architecture",level:3},{value:"Nodes",id:"nodes",level:4},{value:"Communication Primitives",id:"communication-primitives",level:4},{value:"Packages",id:"packages",level:4},{value:"Core Architecture Components",id:"core-architecture-components",level:2},{value:"Client Library (rclcpp/rclpy)",id:"client-library-rclcpprclpy",level:3},{value:"rclcpp (C++)",id:"rclcpp-c",level:4},{value:"rclpy (Python)",id:"rclpy-python",level:4},{value:"Middleware: DDS (Data Distribution Service)",id:"middleware-dds-data-distribution-service",level:3},{value:"DDS Implementation Options",id:"dds-implementation-options",level:4},{value:"Launch System",id:"launch-system",level:3},{value:"Launch Files",id:"launch-files",level:4},{value:"Process Management",id:"process-management",level:4},{value:"Quality of Service (QoS) Profiles",id:"quality-of-service-qos-profiles",level:2},{value:"Understanding QoS",id:"understanding-qos",level:3},{value:"Reliability Policies",id:"reliability-policies",level:4},{value:"Durability Policies",id:"durability-policies",level:4},{value:"History Policies",id:"history-policies",level:4},{value:"Rate Policies",id:"rate-policies",level:4},{value:"QoS in Practice",id:"qos-in-practice",level:3},{value:"Communication Patterns",id:"communication-patterns",level:2},{value:"Topics (Publish/Subscribe)",id:"topics-publishsubscribe",level:3},{value:"Publisher Example",id:"publisher-example",level:4},{value:"Subscriber Example",id:"subscriber-example",level:4},{value:"Services (Request/Response)",id:"services-requestresponse",level:3},{value:"Service Server",id:"service-server",level:4},{value:"Service Client",id:"service-client",level:4},{value:"Actions (Goal-Based Communication)",id:"actions-goal-based-communication",level:3},{value:"Action Server",id:"action-server",level:4},{value:"ROS 2 Parameters System",id:"ros-2-parameters-system",level:2},{value:"Parameter Management",id:"parameter-management",level:3},{value:"Parameter Declaration",id:"parameter-declaration",level:4},{value:"Parameter Callbacks",id:"parameter-callbacks",level:4},{value:"ROS 2 Tools and Ecosystem",id:"ros-2-tools-and-ecosystem",level:2},{value:"Essential Tools",id:"essential-tools",level:3},{value:"ros2 run",id:"ros2-run",level:4},{value:"ros2 topic",id:"ros2-topic",level:4},{value:"ros2 service",id:"ros2-service",level:4},{value:"ros2 action",id:"ros2-action",level:4},{value:"rqt and rviz2",id:"rqt-and-rviz2",level:4},{value:"Debugging and Monitoring",id:"debugging-and-monitoring",level:3},{value:"ros2 doctor",id:"ros2-doctor",level:4},{value:"ros2 bag",id:"ros2-bag",level:4},{value:"Security in ROS 2",id:"security-in-ros-2",level:2},{value:"Security Features",id:"security-features",level:3},{value:"Authentication",id:"authentication",level:4},{value:"Authorization",id:"authorization",level:4},{value:"Encryption",id:"encryption",level:4},{value:"Security Configuration",id:"security-configuration",level:3},{value:"Performance Considerations",id:"performance-considerations",level:2},{value:"Real-time Performance",id:"real-time-performance",level:3},{value:"Real-time Scheduling",id:"real-time-scheduling",level:4},{value:"Communication Optimization",id:"communication-optimization",level:4},{value:"Memory Management",id:"memory-management",level:3},{value:"Message Allocation",id:"message-allocation",level:4},{value:"Integration with Physical AI Systems",id:"integration-with-physical-ai-systems",level:2},{value:"Coordination of Complex Systems",id:"coordination-of-complex-systems",level:3},{value:"Sensor Integration",id:"sensor-integration",level:4},{value:"Actuator Control",id:"actuator-control",level:4},{value:"Perception Systems",id:"perception-systems",level:4},{value:"Example: Humanoid Robot Control Architecture",id:"example-humanoid-robot-control-architecture",level:3},{value:"Core Nodes",id:"core-nodes",level:4},{value:"Communication Patterns",id:"communication-patterns-1",level:4},{value:"Best Practices",id:"best-practices",level:2},{value:"Node Design",id:"node-design",level:3},{value:"Single Responsibility",id:"single-responsibility",level:4},{value:"Lifecycle Management",id:"lifecycle-management",level:4},{value:"Communication Design",id:"communication-design",level:3},{value:"Appropriate QoS Selection",id:"appropriate-qos-selection",level:4},{value:"Message Design",id:"message-design",level:4},{value:"Error Handling",id:"error-handling",level:3},{value:"Robust Error Handling",id:"robust-error-handling",level:4},{value:"Chapter Summary",id:"chapter-summary",level:2},{value:"Exercises",id:"exercises",level:2},{value:"Further Reading",id:"further-reading",level:2}];function d(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"chapter-3-understanding-the-robotic-nervous-system-ros-2-architecture",children:"Chapter 3: Understanding the Robotic Nervous System: ROS 2 Architecture"}),"\n",(0,s.jsx)(n.h2,{id:"chapter-overview",children:"Chapter Overview"}),"\n",(0,s.jsx)(n.p,{children:'This chapter delves into the Robot Operating System 2 (ROS 2), the sophisticated software architecture that serves as the "nervous system" for modern robots. We\'ll explore how ROS 2 provides the communication infrastructure, tools, and frameworks that enable complex robotic systems to coordinate their sensors, actuators, and processing capabilities effectively. Understanding ROS 2 architecture is crucial for developing any sophisticated robotic system, particularly humanoid robots that require tight coordination between multiple subsystems.'}),"\n",(0,s.jsx)(n.h2,{id:"learning-outcomes",children:"Learning Outcomes"}),"\n",(0,s.jsx)(n.p,{children:"By the end of this chapter, you will be able to:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Explain the fundamental concepts and architecture of ROS 2"}),"\n",(0,s.jsx)(n.li,{children:"Describe the differences between ROS 1 and ROS 2"}),"\n",(0,s.jsx)(n.li,{children:"Understand the communication patterns in ROS 2 (nodes, topics, services, actions)"}),"\n",(0,s.jsx)(n.li,{children:"Implement basic ROS 2 nodes and communication patterns"}),"\n",(0,s.jsx)(n.li,{children:"Apply ROS 2 concepts to coordinate complex robotic systems"}),"\n",(0,s.jsx)(n.li,{children:"Evaluate when and why to use ROS 2 in robotic applications"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"introduction-to-ros-2",children:"Introduction to ROS 2"}),"\n",(0,s.jsx)(n.h3,{id:"what-is-ros-2",children:"What is ROS 2?"}),"\n",(0,s.jsx)(n.p,{children:"Robot Operating System 2 (ROS 2) is not an operating system in the traditional sense, but rather a flexible framework for writing robot software. It provides a collection of tools, libraries, and conventions that aim to simplify the task of creating complex and robust robot behavior across a wide variety of robotic platforms."}),"\n",(0,s.jsx)(n.p,{children:'ROS 2 serves as the "nervous system" of robotic systems by providing:'}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Communication infrastructure"}),": How different components of a robot communicate"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Tooling"}),": Debugging, visualization, and development tools"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Package management"}),": How code is organized and distributed"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Hardware abstraction"}),": How software interfaces with different hardware platforms"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Platform independence"}),": Ability to run on different operating systems and architectures"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"historical-context-from-ros-1-to-ros-2",children:"Historical Context: From ROS 1 to ROS 2"}),"\n",(0,s.jsx)(n.p,{children:"The original ROS (Robot Operating System 1) was developed in 2007 and became widely adopted in robotics research and development. However, as robotics applications evolved, several limitations became apparent:"}),"\n",(0,s.jsx)(n.h4,{id:"ros-1-limitations",children:"ROS 1 Limitations"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Real-time support"}),": No native real-time capabilities"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Security"}),": No built-in security features"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Multi-robot systems"}),": Complex to implement"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Deterministic behavior"}),": No guarantees for message delivery"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Middleware flexibility"}),": Tied to a single communication layer"]}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"ros-2-solutions",children:"ROS 2 Solutions"}),"\n",(0,s.jsx)(n.p,{children:"ROS 2 was designed from the ground up to address these limitations:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"DDS-based communication"}),": Data Distribution Service for flexible, robust communication"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Security by design"}),": Built-in security features and authentication"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Real-time support"}),": Native real-time capabilities"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Improved tools"}),": Better debugging and visualization tools"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Enhanced multi-robot support"}),": Better support for multiple robots and complex systems"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"key-concepts-in-ros-2-architecture",children:"Key Concepts in ROS 2 Architecture"}),"\n",(0,s.jsx)(n.h4,{id:"nodes",children:"Nodes"}),"\n",(0,s.jsx)(n.p,{children:"Nodes are the fundamental building blocks of ROS 2 applications. Each node typically performs a specific task or represents a specific hardware component:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"# Example of a simple ROS 2 node structure\nimport rclpy\nfrom rclpy.node import Node\n\nclass SensorNode(Node):\n    def __init__(self):\n        super().__init__('sensor_node')\n        # Node initialization code\n"})}),"\n",(0,s.jsx)(n.h4,{id:"communication-primitives",children:"Communication Primitives"}),"\n",(0,s.jsx)(n.p,{children:"ROS 2 provides several communication patterns:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Topics"}),": Publish/subscribe pattern for asynchronous communication"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Services"}),": Request/response pattern for synchronous communication"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Actions"}),": Goal-based communication for long-running tasks"]}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"packages",children:"Packages"}),"\n",(0,s.jsx)(n.p,{children:"ROS 2 organizes code into packages, which are the basic units of software organization:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Contain source code, launch files, configuration files"}),"\n",(0,s.jsxs)(n.li,{children:["Provide build configuration through ",(0,s.jsx)(n.code,{children:"package.xml"})]}),"\n",(0,s.jsx)(n.li,{children:"Enable code reuse and sharing across projects"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"core-architecture-components",children:"Core Architecture Components"}),"\n",(0,s.jsx)(n.h3,{id:"client-library-rclcpprclpy",children:"Client Library (rclcpp/rclpy)"}),"\n",(0,s.jsx)(n.p,{children:"The client library is the core implementation of ROS 2 concepts for specific programming languages:"}),"\n",(0,s.jsx)(n.h4,{id:"rclcpp-c",children:"rclcpp (C++)"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Optimized for performance-critical applications"}),"\n",(0,s.jsx)(n.li,{children:"Lower latency and higher throughput"}),"\n",(0,s.jsx)(n.li,{children:"Preferred for real-time systems and embedded applications"}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"rclpy-python",children:"rclpy (Python)"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Easier to use for rapid prototyping"}),"\n",(0,s.jsx)(n.li,{children:"More accessible for researchers and beginners"}),"\n",(0,s.jsx)(n.li,{children:"Good for testing and development"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"middleware-dds-data-distribution-service",children:"Middleware: DDS (Data Distribution Service)"}),"\n",(0,s.jsx)(n.p,{children:"DDS is the underlying communication middleware that provides:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Message passing"}),": Reliable communication between nodes"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Quality of Service (QoS)"}),": Configurable communication behavior"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Discovery"}),": Automatic node discovery and communication setup"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Transport abstraction"}),": Support for different network protocols"]}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"dds-implementation-options",children:"DDS Implementation Options"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Fast DDS"}),": RTI's implementation, default in recent ROS 2 versions"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Cyclone DDS"}),": Eclipse implementation, lightweight"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"OpenSplice DDS"}),": ADLINK implementation"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Connext DDS"}),": RTI's commercial implementation"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"launch-system",children:"Launch System"}),"\n",(0,s.jsx)(n.p,{children:"The launch system manages the startup and configuration of complex robot systems:"}),"\n",(0,s.jsx)(n.h4,{id:"launch-files",children:"Launch Files"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"XML Format"}),": Traditional launch configuration"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Python Format"}),": More flexible, programmable configuration"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"YAML Format"}),": Parameter configuration"]}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"process-management",children:"Process Management"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Starting multiple nodes simultaneously"}),"\n",(0,s.jsx)(n.li,{children:"Managing node lifecycles"}),"\n",(0,s.jsx)(n.li,{children:"Environment configuration"}),"\n",(0,s.jsx)(n.li,{children:"Error handling and recovery"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"quality-of-service-qos-profiles",children:"Quality of Service (QoS) Profiles"}),"\n",(0,s.jsx)(n.h3,{id:"understanding-qos",children:"Understanding QoS"}),"\n",(0,s.jsx)(n.p,{children:"QoS profiles define how messages are delivered between nodes, including reliability, durability, and other properties:"}),"\n",(0,s.jsx)(n.h4,{id:"reliability-policies",children:"Reliability Policies"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Reliable"}),": Every message is guaranteed to be delivered"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Best Effort"}),": Messages may be lost but delivery is not guaranteed"]}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"durability-policies",children:"Durability Policies"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Transient Local"}),": Publishers send recent messages to new subscribers"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Volatile"}),": Only future messages are sent to new subscribers"]}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"history-policies",children:"History Policies"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Keep Last"}),": Only store the most recent messages"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Keep All"}),": Store all messages (limited by memory)"]}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"rate-policies",children:"Rate Policies"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Depth"}),": Maximum number of messages to store"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Deadline"}),": Maximum time between messages"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Lifespan"}),": Maximum lifetime of a message"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"qos-in-practice",children:"QoS in Practice"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"from rclpy.qos import QoSProfile, ReliabilityPolicy, HistoryPolicy\n\n# Configuration for critical sensor data\ncritical_qos = QoSProfile(\n    reliability=ReliabilityPolicy.RELIABLE,\n    history=HistoryPolicy.KEEP_LAST,\n    depth=10\n)\n\n# Configuration for high-frequency, less critical data\nhigh_freq_qos = QoSProfile(\n    reliability=ReliabilityPolicy.BEST_EFFORT,\n    history=HistoryPolicy.KEEP_LAST,\n    depth=1\n)\n"})}),"\n",(0,s.jsx)(n.h2,{id:"communication-patterns",children:"Communication Patterns"}),"\n",(0,s.jsx)(n.h3,{id:"topics-publishsubscribe",children:"Topics (Publish/Subscribe)"}),"\n",(0,s.jsx)(n.p,{children:"Topics enable asynchronous, many-to-many communication:"}),"\n",(0,s.jsx)(n.h4,{id:"publisher-example",children:"Publisher Example"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom std_msgs.msg import String\n\nclass TalkerNode(Node):\n    def __init__(self):\n        super().__init__('talker')\n        self.publisher = self.create_publisher(String, 'chatter', 10)\n        timer_period = 0.5  # seconds\n        self.timer = self.create_timer(timer_period, self.timer_callback)\n        self.i = 0\n\n    def timer_callback(self):\n        msg = String()\n        msg.data = f'Hello World: {self.i}'\n        self.publisher.publish(msg)\n        self.get_logger().info(f'Publishing: \"{msg.data}\"')\n        self.i += 1\n"})}),"\n",(0,s.jsx)(n.h4,{id:"subscriber-example",children:"Subscriber Example"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom std_msgs.msg import String\n\nclass ListenerNode(Node):\n    def __init__(self):\n        super().__init__('listener')\n        self.subscription = self.create_subscription(\n            String,\n            'chatter',\n            self.listener_callback,\n            10)\n        self.subscription  # prevent unused variable warning\n\n    def listener_callback(self, msg):\n        self.get_logger().info(f'I heard: \"{msg.data}\"')\n"})}),"\n",(0,s.jsx)(n.h3,{id:"services-requestresponse",children:"Services (Request/Response)"}),"\n",(0,s.jsx)(n.p,{children:"Services enable synchronous, request/response communication:"}),"\n",(0,s.jsx)(n.h4,{id:"service-server",children:"Service Server"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"from example_interfaces.srv import AddTwoInts\n\nclass AddTwoIntsServer(Node):\n    def __init__(self):\n        super().__init__('add_two_ints_server')\n        self.srv = self.create_service(AddTwoInts, 'add_two_ints', self.add_two_ints_callback)\n\n    def add_two_ints_callback(self, request, response):\n        response.sum = request.a + request.b\n        self.get_logger().info(f'Returning {request.a} + {request.b} = {response.sum}')\n        return response\n"})}),"\n",(0,s.jsx)(n.h4,{id:"service-client",children:"Service Client"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"from example_interfaces.srv import AddTwoInts\n\nclass AddTwoIntsClient(Node):\n    def __init__(self):\n        super().__init__('add_two_ints_client')\n        self.cli = self.create_client(AddTwoInts, 'add_two_ints')\n        while not self.cli.wait_for_service(timeout_sec=1.0):\n            self.get_logger().info('Service not available, waiting again...')\n        self.req = AddTwoInts.Request()\n\n    def send_request(self, a, b):\n        self.req.a = a\n        self.req.b = b\n        self.future = self.cli.call_async(self.req)\n"})}),"\n",(0,s.jsx)(n.h3,{id:"actions-goal-based-communication",children:"Actions (Goal-Based Communication)"}),"\n",(0,s.jsx)(n.p,{children:"Actions handle long-running tasks with feedback:"}),"\n",(0,s.jsx)(n.h4,{id:"action-server",children:"Action Server"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"from rclpy.action import ActionServer\nfrom rclpy.callback_groups import ReentrantCallbackGroup\nfrom example_interfaces.action import Fibonacci\n\nclass FibonacciActionServer(Node):\n    def __init__(self):\n        super().__init__('fibonacci_action_server')\n        self._action_server = ActionServer(\n            self,\n            Fibonacci,\n            'fibonacci',\n            self.execute_callback)\n\n    def execute_callback(self, goal_handle):\n        self.get_logger().info('Executing goal...')\n\n        feedback_msg = Fibonacci.Feedback()\n        feedback_msg.sequence = [0, 1]\n\n        for i in range(1, goal_handle.request.order):\n            if goal_handle.is_cancel_requested:\n                goal_handle.canceled()\n                self.get_logger().info('Goal canceled')\n                return Fibonacci.Result()\n\n            feedback_msg.sequence.append(\n                feedback_msg.sequence[i] + feedback_msg.sequence[i-1])\n\n            self.get_logger().info(f'Publishing feedback: {feedback_msg.sequence}')\n            goal_handle.publish_feedback(feedback_msg)\n\n        goal_handle.succeed()\n        result = Fibonacci.Result()\n        result.sequence = feedback_msg.sequence\n        self.get_logger().info(f'Returning result: {result.sequence}')\n        return result\n"})}),"\n",(0,s.jsx)(n.h2,{id:"ros-2-parameters-system",children:"ROS 2 Parameters System"}),"\n",(0,s.jsx)(n.h3,{id:"parameter-management",children:"Parameter Management"}),"\n",(0,s.jsx)(n.p,{children:"ROS 2 provides a flexible system for configuring nodes at runtime:"}),"\n",(0,s.jsx)(n.h4,{id:"parameter-declaration",children:"Parameter Declaration"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"class ParameterNode(Node):\n    def __init__(self):\n        super().__init__('parameter_node')\n\n        # Declare parameters with default values and descriptions\n        self.declare_parameter('robot_name', 'default_robot')\n        self.declare_parameter('max_velocity', 1.0)\n        self.declare_parameter('safety_enabled', True)\n\n    def get_parameters(self):\n        robot_name = self.get_parameter('robot_name').value\n        max_velocity = self.get_parameter('max_velocity').value\n        safety_enabled = self.get_parameter('safety_enabled').value\n        return robot_name, max_velocity, safety_enabled\n"})}),"\n",(0,s.jsx)(n.h4,{id:"parameter-callbacks",children:"Parameter Callbacks"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"def parameter_callback(self, parameters):\n    for param in parameters:\n        if param.name == 'max_velocity' and param.type_ == Parameter.Type.DOUBLE:\n            self.max_velocity = param.value\n            self.get_logger().info(f'Max velocity updated to: {self.max_velocity}')\n    return SetParametersResult(successful=True)\n\n# Set up callback\nself.set_parameters_callback(self.parameter_callback)\n"})}),"\n",(0,s.jsx)(n.h2,{id:"ros-2-tools-and-ecosystem",children:"ROS 2 Tools and Ecosystem"}),"\n",(0,s.jsx)(n.h3,{id:"essential-tools",children:"Essential Tools"}),"\n",(0,s.jsx)(n.h4,{id:"ros2-run",children:"ros2 run"}),"\n",(0,s.jsx)(n.p,{children:"Execute individual nodes within packages:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"ros2 run package_name executable_name\n"})}),"\n",(0,s.jsx)(n.h4,{id:"ros2-topic",children:"ros2 topic"}),"\n",(0,s.jsx)(n.p,{children:"Monitor and interact with topics:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"ros2 topic list          # List all topics\nros2 topic echo /topic_name  # Print messages\nros2 topic info /topic_name  # Get topic information\n"})}),"\n",(0,s.jsx)(n.h4,{id:"ros2-service",children:"ros2 service"}),"\n",(0,s.jsx)(n.p,{children:"Interact with services:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'ros2 service list        # List all services\nros2 service call /service_name service_type "request_data"\n'})}),"\n",(0,s.jsx)(n.h4,{id:"ros2-action",children:"ros2 action"}),"\n",(0,s.jsx)(n.p,{children:"Work with actions:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'ros2 action list         # List all actions\nros2 action send_goal /action_name action_type "goal_data"\n'})}),"\n",(0,s.jsx)(n.h4,{id:"rqt-and-rviz2",children:"rqt and rviz2"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"rqt"}),": Graphical user interface for monitoring and controlling ROS 2 systems"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"rviz2"}),": 3D visualization tool for robot data and environments"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"debugging-and-monitoring",children:"Debugging and Monitoring"}),"\n",(0,s.jsx)(n.h4,{id:"ros2-doctor",children:"ros2 doctor"}),"\n",(0,s.jsx)(n.p,{children:"Diagnose ROS 2 installation and runtime issues:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"ros2 doctor\n"})}),"\n",(0,s.jsx)(n.h4,{id:"ros2-bag",children:"ros2 bag"}),"\n",(0,s.jsx)(n.p,{children:"Record and replay ROS 2 data for debugging:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Record all topics\nros2 bag record -a\n\n# Play back recorded data\nros2 bag play recorded_bag\n"})}),"\n",(0,s.jsx)(n.h2,{id:"security-in-ros-2",children:"Security in ROS 2"}),"\n",(0,s.jsx)(n.h3,{id:"security-features",children:"Security Features"}),"\n",(0,s.jsx)(n.p,{children:"ROS 2 includes built-in security capabilities:"}),"\n",(0,s.jsx)(n.h4,{id:"authentication",children:"Authentication"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Identity verification for nodes"}),"\n",(0,s.jsx)(n.li,{children:"Certificate-based authentication"}),"\n",(0,s.jsx)(n.li,{children:"PKI (Public Key Infrastructure) support"}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"authorization",children:"Authorization"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Access control for topics, services, and actions"}),"\n",(0,s.jsx)(n.li,{children:"Role-based permissions"}),"\n",(0,s.jsx)(n.li,{children:"Secure resource access"}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"encryption",children:"Encryption"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Data encryption in transit"}),"\n",(0,s.jsx)(n.li,{children:"Secure communication channels"}),"\n",(0,s.jsx)(n.li,{children:"Protection against eavesdropping"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"security-configuration",children:"Security Configuration"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"# Example security configuration\nname: secure_robot_system\ndomain_id: 0\nsecurity: true\nsecurity_root: /path/to/security/certificates\n"})}),"\n",(0,s.jsx)(n.h2,{id:"performance-considerations",children:"Performance Considerations"}),"\n",(0,s.jsx)(n.h3,{id:"real-time-performance",children:"Real-time Performance"}),"\n",(0,s.jsx)(n.p,{children:"ROS 2 supports real-time systems with proper configuration:"}),"\n",(0,s.jsx)(n.h4,{id:"real-time-scheduling",children:"Real-time Scheduling"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Use SCHED_FIFO or SCHED_RR scheduling policies"}),"\n",(0,s.jsx)(n.li,{children:"Lock memory to prevent page faults"}),"\n",(0,s.jsx)(n.li,{children:"Configure CPU affinity for critical processes"}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"communication-optimization",children:"Communication Optimization"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Choose appropriate QoS settings"}),"\n",(0,s.jsx)(n.li,{children:"Minimize message size and frequency"}),"\n",(0,s.jsx)(n.li,{children:"Use shared memory for high-bandwidth data"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"memory-management",children:"Memory Management"}),"\n",(0,s.jsx)(n.h4,{id:"message-allocation",children:"Message Allocation"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Use memory pools to reduce allocation overhead"}),"\n",(0,s.jsx)(n.li,{children:"Reuse message objects when possible"}),"\n",(0,s.jsx)(n.li,{children:"Monitor memory usage for long-running systems"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"integration-with-physical-ai-systems",children:"Integration with Physical AI Systems"}),"\n",(0,s.jsx)(n.h3,{id:"coordination-of-complex-systems",children:"Coordination of Complex Systems"}),"\n",(0,s.jsx)(n.p,{children:"ROS 2 serves as the backbone for coordinating the complex sensor and actuator systems in Physical AI:"}),"\n",(0,s.jsx)(n.h4,{id:"sensor-integration",children:"Sensor Integration"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Standardized interfaces for different sensor types"}),"\n",(0,s.jsx)(n.li,{children:"Synchronized data processing"}),"\n",(0,s.jsx)(n.li,{children:"Quality of service matching sensor requirements"}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"actuator-control",children:"Actuator Control"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Low-latency control loops"}),"\n",(0,s.jsx)(n.li,{children:"Safety monitoring and emergency stops"}),"\n",(0,s.jsx)(n.li,{children:"Multi-joint coordination"}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"perception-systems",children:"Perception Systems"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Real-time processing pipelines"}),"\n",(0,s.jsx)(n.li,{children:"Data fusion from multiple sensors"}),"\n",(0,s.jsx)(n.li,{children:"AI inference integration"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"example-humanoid-robot-control-architecture",children:"Example: Humanoid Robot Control Architecture"}),"\n",(0,s.jsx)(n.p,{children:"A typical humanoid robot using ROS 2 might have the following architecture:"}),"\n",(0,s.jsx)(n.h4,{id:"core-nodes",children:"Core Nodes"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Joint Controller"}),": Low-level motor control"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Balance Controller"}),": High-level balance and posture control"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Sensor Processor"}),": Raw sensor data processing"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"State Estimator"}),": Robot state estimation and filtering"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Motion Planner"}),": Trajectory planning and path planning"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Behavior Manager"}),": High-level task execution"]}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"communication-patterns-1",children:"Communication Patterns"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Sensors"}),": Publishers to topics with appropriate QoS"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Control"}),": Services for immediate commands, actions for complex behaviors"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Planning"}),": Services for path planning, topics for plan updates"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Monitoring"}),": Topics for state information and diagnostics"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,s.jsx)(n.h3,{id:"node-design",children:"Node Design"}),"\n",(0,s.jsx)(n.h4,{id:"single-responsibility",children:"Single Responsibility"}),"\n",(0,s.jsx)(n.p,{children:"Each node should have a clear, single purpose to maintain modularity and maintainability."}),"\n",(0,s.jsx)(n.h4,{id:"lifecycle-management",children:"Lifecycle Management"}),"\n",(0,s.jsx)(n.p,{children:"Implement proper node lifecycle for initialization, activation, and cleanup:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"def on_configure(self, state):\n    # Setup resources\n    return TransitionCallbackReturn.SUCCESS\n\ndef on_activate(self, state):\n    # Activate functionality\n    return TransitionCallbackReturn.SUCCESS\n"})}),"\n",(0,s.jsx)(n.h3,{id:"communication-design",children:"Communication Design"}),"\n",(0,s.jsx)(n.h4,{id:"appropriate-qos-selection",children:"Appropriate QoS Selection"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Use reliable QoS for critical data (sensor data, commands)"}),"\n",(0,s.jsx)(n.li,{children:"Use best effort for high-frequency, less critical data (diagnostics, status)"}),"\n",(0,s.jsx)(n.li,{children:"Choose appropriate history depth based on application needs"}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"message-design",children:"Message Design"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Keep messages small and efficient"}),"\n",(0,s.jsx)(n.li,{children:"Use appropriate data types"}),"\n",(0,s.jsx)(n.li,{children:"Consider frequency and bandwidth requirements"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"error-handling",children:"Error Handling"}),"\n",(0,s.jsx)(n.h4,{id:"robust-error-handling",children:"Robust Error Handling"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Implement timeout handling for service calls"}),"\n",(0,s.jsx)(n.li,{children:"Monitor node health and connectivity"}),"\n",(0,s.jsx)(n.li,{children:"Graceful degradation when components fail"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"chapter-summary",children:"Chapter Summary"}),"\n",(0,s.jsx)(n.p,{children:'This chapter has explored ROS 2 as the "nervous system" of modern robotics, providing the essential communication infrastructure and tools that enable complex robotic systems to coordinate effectively. We\'ve covered the core architectural components including nodes, topics, services, actions, and the DDS middleware that enables flexible, reliable communication.'}),"\n",(0,s.jsx)(n.p,{children:"ROS 2's improvements over ROS 1, including security, real-time support, and enhanced multi-robot capabilities, make it the preferred framework for complex robotic applications including humanoid robots. The Quality of Service system allows precise control over communication behavior, while the parameter system enables flexible configuration."}),"\n",(0,s.jsx)(n.p,{children:"The next chapter will delve deeper into the specific communication patterns of nodes, topics, services, and actions, examining how these fundamental ROS 2 concepts are implemented and used in practical robotic applications."}),"\n",(0,s.jsx)(n.h2,{id:"exercises",children:"Exercises"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Implementation"}),": Create a simple ROS 2 package with a publisher and subscriber node that communicate sensor data between them, using appropriate QoS settings."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Analysis"}),": Compare the performance characteristics of topics, services, and actions. When would you choose each communication pattern for different types of robot communication needs?"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Design"}),": Design a ROS 2 architecture for a simple mobile robot with sensors (camera, LIDAR, IMU) and actuators (motors). Specify the nodes, topics, services, and QoS policies you would use."]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"further-reading",children:"Further Reading"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Morgan Quigley et al. (2014). ",(0,s.jsx)(n.em,{children:"Programming Robots with ROS: A Practical Introduction to the Robot Operating System"})]}),"\n",(0,s.jsxs)(n.li,{children:["Anis Koubaa (2020). ",(0,s.jsx)(n.em,{children:"ROS Robotics Projects: Build and program popular robotic platforms with ROS"})]}),"\n",(0,s.jsxs)(n.li,{children:["ROS 2 Documentation: ",(0,s.jsx)(n.a,{href:"https://docs.ros.org/en/humble/",children:"https://docs.ros.org/en/humble/"})]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>l,x:()=>o});var s=i(6540);const r={},t=s.createContext(r);function l(e){const n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);