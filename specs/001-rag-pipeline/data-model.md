# Data Model: RAG Pipeline

## BookContentChunk

**Description**: A semantically coherent segment of book content that has been processed for RAG, containing the text content, metadata, and vector embedding.

**Fields**:
- `id` (string): Unique identifier combining URL and chunk index
- `content` (string): The actual text content of the chunk
- `url` (string): Original URL of the source page
- `title` (string): Page title from HTML
- `section` (string): Section/chapter identifier
- `chunk_index` (integer): Sequential index of this chunk within the source page
- `content_hash` (string): Hash of the content for change detection
- `created_at` (datetime): Timestamp when chunk was created
- `updated_at` (datetime): Timestamp when chunk was last updated

**Validation rules**:
- `content` must be non-empty and less than 1000 tokens
- `url` must be a valid URL format
- `content_hash` must be a valid SHA256 hash

## VectorEmbedding

**Description**: A numerical representation of content chunk generated by Cohere models that enables semantic similarity search.

**Fields**:
- `chunk_id` (string): Reference to the associated BookContentChunk
- `vector` (array of floats): The embedding vector (768 dimensions)
- `model_name` (string): Name of the model used to generate the embedding
- `model_version` (string): Version of the model used
- `created_at` (datetime): Timestamp when embedding was generated

**Validation rules**:
- `vector` must have exactly 768 dimensions
- `model_name` must match Cohere's supported models
- `chunk_id` must reference an existing BookContentChunk

## IngestionPipeline

**Description**: Configuration and state tracking for the ingestion pipeline run.

**Fields**:
- `run_id` (string): Unique identifier for this pipeline run
- `status` (enum): Current status (pending, running, completed, failed)
- `start_time` (datetime): When the pipeline run started
- `end_time` (datetime): When the pipeline run completed/failed
- `processed_urls` (integer): Number of URLs processed
- `successful_chunks` (integer): Number of chunks successfully created
- `failed_chunks` (integer): Number of chunks that failed processing
- `total_chunks` (integer): Total number of chunks created in this run
- `source_url` (string): Base URL of the site being ingested

**Validation rules**:
- `status` must be one of the defined enum values
- `processed_urls`, `successful_chunks`, `failed_chunks`, `total_chunks` must be non-negative integers
- `end_time` must be after `start_time` if pipeline completed

## Relationships

- One IngestionPipeline can produce many BookContentChunk instances
- One BookContentChunk has one VectorEmbedding
- VectorEmbedding references BookContentChunk via chunk_id